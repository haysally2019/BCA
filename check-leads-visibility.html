<!DOCTYPE html>
<html>
<head>
    <title>Check Leads Visibility</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Lead Distribution Checker</h1>
    <div id="output"></div>
    <script>
        const supabaseUrl = 'https://gpupamrhpmrgslqnzzpb.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwdXBhbXJocG1yZ3NscW56enBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNzExMzQsImV4cCI6MjA3NDc0NzEzNH0.5QBTQQGm8iFhWT4ic2yNFcAvjJX0EWgcvOnuqgv-5Us';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function checkLeads() {
            const output = document.getElementById('output');
            
            // Get current user
            const { data: { user } } = await supabase.auth.getUser();
            
            if (!user) {
                output.innerHTML = '<p>No user logged in. Please log in first.</p>';
                return;
            }
            
            output.innerHTML += `<h2>Current User: ${user.email}</h2>`;
            output.innerHTML += `<p>User ID: ${user.id}</p>`;
            
            // Get profile
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('*')
                .eq('user_id', user.id)
                .maybeSingle();
            
            if (profileError) {
                output.innerHTML += `<p style="color:red">Profile Error: ${profileError.message}</p>`;
            } else if (profile) {
                output.innerHTML += `<p>Profile ID: ${profile.id}</p>`;
                output.innerHTML += `<p>Company Name: ${profile.company_name}</p>`;
                
                // Get leads for this profile
                const { data: leads, error: leadsError } = await supabase
                    .from('leads')
                    .select('*')
                    .eq('company_id', profile.id);
                
                if (leadsError) {
                    output.innerHTML += `<p style="color:red">Leads Error: ${leadsError.message}</p>`;
                } else {
                    output.innerHTML += `<h3>Leads Count: ${leads.length}</h3>`;
                    if (leads.length > 0) {
                        output.innerHTML += '<h4>First 5 leads:</h4>';
                        leads.slice(0, 5).forEach(lead => {
                            output.innerHTML += `<p>${lead.name} - ${lead.phone}</p>`;
                        });
                    } else {
                        output.innerHTML += '<p style="color:red">No leads found for this profile!</p>';
                    }
                }
            } else {
                output.innerHTML += '<p style="color:red">No profile found for this user!</p>';
            }
        }
        
        checkLeads();
    </script>
</body>
</html>
